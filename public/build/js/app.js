"use strict";let numOther;console.log("app.js"),document.addEventListener("DOMContentLoaded",e=>{iniciarApp()});let paso=1,pasoInicial=1,pasoFinal=3;const cita={id:"",nombre:"",fecha:"",hora:"",servicios:[]};function iniciarApp(){mostrar(),buttons(),paginador(paso),anterior(),posterior(),consultarAPI(),nombreCliente(),seleccionarDate(),resume()}function buttons(){let e=document.querySelectorAll(".tabs button");console.log(e),e.forEach(e=>{e.addEventListener("click",e=>{paso=e.target.dataset.paso,mostrar(paso),paginador(paso)})})}function mostrar(e){let t=document.querySelector(".mostrar");t&&t.classList.remove("mostrar");let a=document.querySelector(".actual");a&&a.classList.remove("actual");let o=document.getElementById("paso-"+e);o&&o.classList.add("mostrar");let n=document.querySelector(`[data-paso='${e}']`);n&&n.classList.add("actual")}function paginador(e){let t=document.querySelector(".left"),a=document.querySelector(".right");1==e?(t.classList.add("ocultar"),a.classList.remove("ocultar")):3==e?(t.classList.remove("ocultar"),a.classList.add("ocultar"),resume()):(t.classList.remove("ocultar"),a.classList.remove("ocultar")),mostrar(e)}function anterior(){document.querySelector(".left").addEventListener("click",()=>{paso<=pasoInicial||(paso--,console.log(paso),paginador(paso))})}function posterior(){document.querySelector(".right").addEventListener("click",()=>{paso>=pasoFinal?resume():(paso++,paginador(paso))})}async function consultarAPI(){try{const e="http://localhost:3000/api/servicios",t=await fetch(e);mostrarservicios(await t.json())}catch(e){console.log(e)}}function mostrarservicios(e){let t=document.querySelector(".listado-servicios");for(let a=0;a<e.length;a++){let o=document.createElement("DIV");o.classList.add("servicio"),o.dataset.idServicio=e[a].id,o.addEventListener("click",t=>{enviarServicios(e[a])});let n=document.createElement("P");n.classList.add("producto"),n.textContent=e[a].nombre,o.appendChild(n);let s=document.createElement("P");s.classList.add("precio"),s.textContent="$"+e[a].precio,o.appendChild(s),t.appendChild(o)}}function enviarServicios(e){let{servicios:t}=cita,a=document.querySelector(`.servicio[data-id-servicio='${e.id}']`);t.some(t=>t.id==e.id)?(a.classList.remove("selected"),cita.servicios=[...t,e],cita.servicios=t.filter(t=>t.id!==e.id),console.log(cita.servicios)):(cita.servicios=[...t,e],a.classList.add("selected"))}function nombreCliente(){let e=document.querySelector(".cita-id").value;cita.id=e;let t=document.querySelector(".cita-cliente").value;cita.nombre=t}function seleccionarDate(){let e=document.querySelector(".msg-cerrado"),t=document.querySelector(".cita-fecha");t.addEventListener("input",a=>{let o=new Date(t.value).getUTCDay();console.log((new Date).getUTCDay()),0==o||6==o?(e.textContent="Sabados y Domingos estamos cerrados.\n            Atentamente Los pelados S.A.",e.style.display="flex",t.value=""):cita.fecha=t.value});let a=document.querySelector(".cita-hour");a.addEventListener("input",t=>{let o=t.target.value;o=o.split(":")[0],o<9?(e.textContent="Antes de las 9 estamos cerrados.\n        Atentamente Los pelados S.A.",e.style.display="flex",a.value=""):o>21?(e.textContent="Despues de las 21 estamos cerrados.\n        Atentamente Los pelados S.A.",e.style.display="flex",a.value=""):cita.hora=a.value})}function resume(){let e=document.querySelector(".resumen"),t=(document.querySelector(".buttonCita"),Object.values(cita));console.log(t);const{nombre:a,fecha:o,hora:n,servicios:s}=cita;if(console.log(cita),console.log(s),console.log(numOther),t.includes("")||0==cita.servicios.length)return;if(s===numOther)return void console.log("holi");let c=document.querySelector(".resumenDatos"),r=document.createElement("DIV"),i=document.createElement("P");i.classList.add("cross"),i.textContent="X",r.appendChild(i),r.classList.add("resumen-citaCont");let l=document.createElement("P");l.classList.add("resumen-attr"),l.innerHTML=`Nombre: <span class="inner-resumen-nom">${a}</span>`;const d=new Date(o),u=d.getFullYear(),m=d.getMonth(),p=d.getDate()+2,v=new Date(Date.UTC(u,m,p)).toLocaleDateString("es-MX",{weekday:"long",year:"numeric",month:"long",day:"numeric"});console.log(v);let h=document.createElement("P");h.classList.add("resumen-attr"),h.classList.add("date-test"),h.innerHTML=`Fecha: <span class="inner-resumen-date">${v}</span>`;let g=document.createElement("P");g.classList.add("resumen-attr"),g.innerHTML=`Hora: <span class="inner-resumen-hour">${n}</span>`;for(let e=0;e<s.length;e++){let t=document.createElement("P");t.classList.add("resumen-attr");let a=document.createElement("P");a.classList.add("resumen-attr"),t.innerHTML=`Servicio: <span class="inner-resumen-service"> ${cita.servicios[e].nombre} </span> <br> `,a.innerHTML=`Precio <span class="inner-resumen-service"> $${s[e].precio} </span> <br> `,r.appendChild(t),r.appendChild(a)}e.appendChild(r);let L=document.querySelector(".date-test");console.log(h.textContent),L||(c.appendChild(l),c.appendChild(h),c.appendChild(g)),numOther=s;let f=document.createElement("BUTTON");f.classList.add("buttonCita"),f.textContent="BOOK",e.appendChild(f),f.onclick=reservarCita}async function reservarCita(){const e=new FormData,{id:t,fecha:a,hora:o,servicios:n}=cita;e.append("usuarioid",t),e.append("fecha",a),e.append("hora",o);const s=n.map(e=>e.id);e.append("servicios",s),console.log([...e]);try{const t="http://localhost:3000/api/citas",a=await fetch(t,{method:"POST",body:e}),o=await a.json();console.log(o),o.resultado&&(console.log("bien"),Swal.fire({icon:"success",title:"Enhorabuena",text:"Cita agendada con exito",button:"OK",fontSize:"10rem",background:"#fff",color:"#000"}).then(()=>{window.location.reload()}))}catch(e){Swal.fire({icon:"error",title:"Lo siento",text:"Hubo un error al cargar tu cita. Intentalo m√°s tarde",button:"Ok"})}}